Below is a **single, complete, copy-paste ready Replit task prompt** to build **User Role & Access Management** for an **ERP covering all modules**, written in a way that:

* âœ… Enhances system capabilities (does NOT invent unrelated features)
* âœ… Is implementation-oriented
* âœ… Works across **all ERP modules**
* âœ… Is audit, approval, and multi-tenant ready
* âœ… Can be executed by Replit agents without ambiguity

---

# âœ… REPLIT MASTER TASK PROMPT

**Feature: Enterprise User Role & Access Management (ERP-Wide)**

---

## Objective

Enhance the existing ERP system by implementing a **centralized, enterprise-grade User Role & Access Management framework** that applies consistently across **all ERP modules**.

This implementation must **reuse and extend existing modules, data models, and workflows**, and **must not introduce new functional business processes** outside of access control.

---

## Scope (Applies to ALL Modules)

The access control system must work uniformly for:

* Finance (GL, AP, AR, Budgeting, Forecasting, Consolidation, Close)
* Procurement
* Inventory & Warehousing
* Sales & CRM
* Projects & Construction
* HR & Payroll
* Assets
* Reporting & Dashboards
* System Configuration & Admin

---

## Core Access Control Model

### 1. Authorization Model

Implement a **Hybrid RBAC + Attribute-Based Access Control (ABAC)** system:

* **RBAC** defines *what actions a user can perform*
* **ABAC** defines *which data the user can access*

No module should bypass this framework.

---

## Roles & Permissions

### 2. Permissions (Atomic Actions)

Permissions must be **fine-grained and action-based**, not module-only.

**Permission naming convention:**

```
<MODULE>_<SUBMODULE>.<ACTION>
```

**Standard Actions (minimum):**

* VIEW
* CREATE
* EDIT
* DELETE
* APPROVE
* POST
* EXPORT
* IMPORT

**Examples:**

```
FIN_AP_INVOICE.CREATE
FIN_AP_INVOICE.APPROVE
FIN_GL_JOURNAL.POST
PROC_PO.CREATE
PROC_PO.APPROVE
PROJ_COST.VIEW
HR_PAYROLL.POST
```

---

### 3. Roles

Roles are **collections of permissions**, not hard-coded logic.

#### Role Types

* System Roles (read-only templates)
* Tenant-defined Roles
* Functional Roles (Finance, Projects, HR, etc.)

Roles must support:

* Create
* Clone
* Modify
* Disable
* Assign permissions dynamically

---

## Data Access Scoping (ABAC)

### 4. Access Scope Attributes

Permissions must be evaluated **together with data scope**, including:

* Organization / Company
* Business Unit / Subsidiary
* Department
* Project
* Cost Center
* Warehouse / Site
* Record Ownership (own / team / all)

**Example:**

```
Permission: FIN_GL_JOURNAL.POST
Scope: company_id = 2 AND project_id IN (P101, P102)
```

---

## User Role Assignment

### 5. Role Assignment Types

Support the following role assignments:

1. **Permanent**
2. **Temporary (with expiry date)**
3. **Context-specific (project / department based)**

A user may hold **multiple roles simultaneously**.

---

### 6. Permission Overrides

Allow **user-level permission overrides**, but enforce:

* Mandatory justification
* Expiry date
* Full audit logging

Overrides must never bypass approval or posting controls.

---

## Approval & Workflow Integration

### 7. Role-Based Approvals

Approval workflows must use roles instead of hard-coded users.

Examples:

* Invoice approval by Finance Manager
* PO approval by Procurement Head
* Budget approval by Controller

Approvals must support:

* Amount-based thresholds
* Multi-level approvals
* Conditional routing (budget availability, project status)

---

## Audit & Compliance

### 8. Mandatory Audit Logging

Log **every access-related change**, including:

* Role creation / modification
* Permission changes
* Role assignments / removals
* Permission overrides
* Privileged actions
* Login & access attempts

Provide queryable audit logs:

```
Who had access to what, when, and why
```

---

## UI / UX Requirements

### 9. Admin UI

Provide screens for:

* Role management
* Permission tree with search
* Role cloning
* Scope assignment
* User role assignment
* Effective permission preview
* Audit log viewer

Admins must be able to **simulate user access**.

---

### 10. End-User Visibility

Users should be able to:

* View assigned roles
* See effective permissions
* Understand why access is granted or denied

---

## Database / Data Model Enhancements

### 11. Required Entities (Extend Existing Schema)

Implement or extend the following:

```
users
roles
permissions
role_permissions
user_roles
role_scopes
user_permission_overrides
audit_logs
```

Ensure:

* Tenant isolation
* Referential integrity
* No hard-coded role logic

---

## Security & Enforcement

### 12. Enforcement Rules

* All API endpoints must validate permissions
* All UI actions must respect access control
* Backend is the source of truth (UI checks are secondary)
* No permission = no access (fail-safe)

---

## Multi-Tenant Behavior

### 13. Tenant Isolation

* Roles are tenant-specific
* System roles are templates only
* Tenants can clone and customize roles
* No cross-tenant access under any condition

---

## Non-Functional Requirements

* Performance-safe permission evaluation
* Cache effective permissions where appropriate
* Secure by default
* Extensible for future modules

---

## Explicit Constraints

ðŸš« Do NOT:

* Create new ERP business modules
* Change existing business logic
* Hard-code role checks
* Bypass approvals or posting rules

âœ… ONLY:

* Enhance access control, authorization, and enforcement
* Integrate with existing workflows and modules

---

## Expected Outcome

A **fully centralized, scalable, and auditable ERP-wide User Role & Access Management system** that:

* Works consistently across all modules
* Supports real-world enterprise complexity
* Is future-proof for growth and compliance

---

If you want next, I can:

* Convert this into **module-wise subtasks**
* Generate **permission catalogs per module**
* Provide **API middleware pseudocode**
* Create **sample role templates (Finance, Projects, HR)**

Just say the word.
